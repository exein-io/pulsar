# Title: Kworker File Creation

# Creation date: 2023/10/26

# Category: Persistence

# Severity: Medium

# Description: This rule monitors for a file creation event originating from a kworker parent process. kworker, or kernel worker, 
# processes are part of the kernel's workqueue mechanism. They are responsible for executing work that has been scheduled
# to be done in kernel space, which might include tasks like handling interrupts, background activities, and other
# kernel-related tasks. Attackers may attempt to evade detection by masquerading as a kernel worker process.

# MITRE ATT&CK Tactic: TA0003 - Persistence - https://attack.mitre.org/tactics/TA0003/

# MITRE ATT&CK Technique: T1547 - Boot or Logon Autostart Execution - https://attack.mitre.org/techniques/T1547/

- name: File creation by kworker
  type: FileCreated
  condition: header.image STARTS_WITH "/usr/bin/kworker" AND NOT header.image STARTS_WITH "/usr/bin/kworker*kcryptd*"

- name: File creation not in log or crash directories
  type: FileCreated
  condition: NOT (payload.filename STARTS_WITH "/var/log" OR payload.filename STARTS_WITH "/var/crash")