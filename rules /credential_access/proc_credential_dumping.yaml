# Title: Proc Credential Dumping

# Creation date: 2023/04/26

# Category: Credential access

# Severity: Medium

# Description: Identifies the execution of the mimipenguin exploit script which is linux adaptation of Windows tool mimikatz.
# Mimipenguin exploit script is used to dump clear text passwords from a currently logged-in user. The tool exploits
# a known vulnerability CVE-2018-20781. Malicious actors can exploit the cleartext credentials in memory by
# dumping the process and extracting lines that have a high probability of containing cleartext passwords.

# MITRE ATT&CK Tactic: TA0006 - Credential Access - https://attack.mitre.org/tactics/TA0006/

# MITRE ATT&CK Technique: T1003 - OS Credential Dumping - https://attack.mitre.org/techniques/T1003/

- name: Suspicious process execution - ps
  type: Exec
  condition: (payload.filename == "/usr/bin/ps" OR payload.filename == "/bin/ps")
    AND 
    (payload.argv CONTAINS "-eo" OR payload.argv CONTAINS "pid" OR payload.argv CONTAINS "command")
    AND
    header.image STARTS_WITH "/usr/bin/"

- name: Suspicious process execution - strings
  type: Exec
  condition: payload.filename ENDS_WITH "/strings" 
    AND 
    payload.argv CONTAINS "/tmp/"