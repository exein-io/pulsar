# Title: Chown Chmod Unauthorized File Read

# Creation date: 2023/07/28

# Category: Privilege escalation

# Severity: Low

# Description: This rule monitors for the execution of the "chown" and "chmod" commands with command line flags that could indicate a
# wildcard injection attack. Linux wildcard injection is a type of security vulnerability where attackers manipulate 
# commands or input containing wildcards (e.g., *, ?, []) to execute unintended operations or access sensitive data by
# tricking the system into interpreting the wildcard characters in unexpected ways.

# MITRE ATT&CK Tactic: TA0004 - Privilege Escalation - https://attack.mitre.org/tactics/TA0004/

# MITRE ATT&CK Technique: T1068 - Exploitation for Privilege Escalation - https://attack.mitre.org/techniques/T1068/

- name: Execute chown with recursive flag
  type: Exec
  condition: payload.filename IN ["/usr/bin/chown", "/bin/chown"] AND payload.argv CONTAINS "-R"

- name: Execute chmod with recursive flag
  type: Exec
  condition: payload.filename IN ["/usr/bin/chmod", "/bin/chmod"] AND payload.argv CONTAINS "-R"

- name: Execute chown with reference flag
  type: Exec
  condition: payload.filename IN ["/usr/bin/chown", "/bin/chown"] AND payload.argv CONTAINS "--reference="

- name: Execute chmod with reference flag
  type: Exec
  condition: payload.filename IN ["/usr/bin/chmod", "/bin/chmod"] AND payload.argv CONTAINS "--reference="