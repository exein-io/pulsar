# Title: Esxi Suspicious Timestomp Touch

# Creation date: 2023/04/11

# Category: Defense evasion

# Severity: Medium

# Description: Identifies instances where the 'touch' command is executed on a Linux system with the "-r" flag,
# which is used to modify the timestamp of a file based on another file's timestamp. The rule targets specific VM-related
# paths, such as "/etc/vmware/", "/usr/lib/vmware/", or "/vmfs/*". These paths are associated with VMware virtualization
# software, and their presence in the touch command arguments may indicate that a threat actor is attempting to
# tamper with timestamps of VM-related files and configurations on the system.

# MITRE ATT&CK Tactic: TA0005 - Defense Evasion - https://attack.mitre.org/tactics/TA0005/

# MITRE ATT&CK Technique: T1070 - Indicator Removal - https://attack.mitre.org/techniques/T1070/

- name: Touch command with reference file
  type: Exec
  condition: payload.filename == "/usr/bin/touch" AND payload.argv CONTAINS "-r" AND (payload.argv CONTAINS "/etc/vmware/" OR payload.argv CONTAINS "/usr/lib/vmware/" OR payload.argv CONTAINS "/vmfs/")