# Title: Linux Kworker Netcon

# Creation date: 2023/10/18

# Category: Command and control

# Severity: Low

# Description: This rule monitors for network connections from a kworker process. kworker, or kernel worker, processes are part of the
# kernel's workqueue mechanism. They are responsible for executing work that has been scheduled to be done in kernel 
# space, which might include tasks like handling interrupts, background activities, and other kernel-related tasks. 
# Attackers may attempt to evade detection by masquerading as a kernel worker process.

# MITRE ATT&CK Tactic: TA0011 - Command and Control - https://attack.mitre.org/tactics/TA0011/

# MITRE ATT&CK Technique: T1036 - Masquerading - https://attack.mitre.org/techniques/T1036/

- name: Suspicious kworker network activity
  type: Accept
  condition: header.image ENDS_WITH "kworker" 
  # AND NOT payload.destination.ip IN ["10.0.0.1", "10.255.255.254", "127.0.0.1", "127.255.255.254", "169.254.0.1", "169.254.255.254", "172.16.0.1", "172.31.255.254", "192.168.0.1", "192.168.255.254", "224.0.0.1", "239.255.255.254"]

- name: Suspicious kworker network activity
  type: Connect
  condition: header.image ENDS_WITH "kworker" 
  # AND NOT payload.destination.ip IN ["10.0.0.1", "10.255.255.254", "127.0.0.1", "127.255.255.254", "169.254.0.1", "169.254.255.254", "172.16.0.1", "172.31.255.254", "192.168.0.1", "192.168.255.254", "224.0.0.1", "239.255.255.254"]