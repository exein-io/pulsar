# Title: Reverse shell 

#

#

#

# https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

- name: Potential Reverse Shell via /dev/tcp
  type: Exec
  category: execution
  severity: high
  description: Detects execution of commands that utilize /dev/tcp to establish network connections, commonly used in reverse shells.
  condition: payload.argv CONTAINS "/dev/tcp/" AND (payload.argv CONTAINS ">&1" OR payload.argv CONTAINS "0>&1" OR payload.argv CONTAINS "2>&1")

- name: Background Process Reverse Shell
  type: Exec
  category: execution
  severity: high
  description: Detects attempts to establish reverse shells using background processes like nohup or setsid.
  condition: (payload.filename ENDS_WITH "/nohup" OR payload.filename ENDS_WITH "/setsid") AND payload.argv CONTAINS "/dev/tcp/" AND payload.argv CONTAINS ">&1"

- name: Netcat Reverse Shell
  type: Exec
  category: execution
  severity: high
  description: Detects use of netcat to establish reverse shells.
  condition: (payload.filename ENDS_WITH "/nc" OR payload.filename ENDS_WITH "/netcat") AND (payload.argv CONTAINS "-e" OR payload.argv CONTAINS "-c")

- name: Python Socket Reverse Shell
  type: Exec
  category: execution
  severity: high
  description: Detects use of Python with socket operations commonly used in reverse shells.
  condition: (payload.filename ENDS_WITH "/python" OR payload.filename ENDS_WITH "/python3") 
    AND payload.argv CONTAINS "socket" 
    AND (payload.argv CONTAINS "exec" OR payload.argv CONTAINS "subprocess" OR payload.argv CONTAINS "os.dup2")

- name: Perl Reverse Shell
  type: Exec
  category: execution
  severity: high
  description: Detects use of Perl with socket operations commonly used in reverse shells.
  condition: payload.filename ENDS_WITH "/perl" AND payload.argv CONTAINS "Socket" 
    AND (payload.argv CONTAINS "exec" OR payload.argv CONTAINS "open")

- name: Bash Input/Output Redirection
  type: Exec
  category: execution 
  severity: medium
  description: Detects suspicious Bash command execution with input/output redirection commonly used in reverse shells.
  condition: (payload.filename ENDS_WITH "/bash" OR payload.filename ENDS_WITH "/sh") 
    AND ((payload.argv CONTAINS "0<&" AND payload.argv CONTAINS ">&1") 
      OR (payload.argv CONTAINS "dev/tcp" AND payload.argv CONTAINS ">&1")
    )