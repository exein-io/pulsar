# Title: User Added to Privileged Group

# Creation date: 2025/04/14

# MITRE ATT&CK Tactic: TA0003 - Persistence - https://attack.mitre.org/tactics/TA0003/

# MITRE ATT&CK Technique: T1547 - Boot or Logon Autostart Execution - https://attack.mitre.org/techniques/T1547/

- name: User Added to Privileged Group
  type: Exec
  category: persistence
  severity: low
  description: Detects attempts to add a user to a privileged group using commands like usermod, adduser, or gpasswd.
    Adversaries may add a user to a privileged group (e.g., root, sudo, admin) to gain elevated access and maintain persistence on the system.
  condition: (payload.filename ENDS_WITH "usermod" OR payload.filename ENDS_WITH "adduser")
    OR (payload.filename ENDS_WITH "gpasswd" 
      AND (
        payload.argv CONTAINS "-a"
        OR payload.argv CONTAINS "--add"
        OR payload.argv CONTAINS "-M"
        OR payload.argv CONTAINS "--members"
      )
    )
    AND (
      payload.argv CONTAINS "root"
      OR payload.argv CONTAINS "admin"
      OR payload.argv CONTAINS "wheel"
      OR payload.argv CONTAINS "staff"
      OR payload.argv CONTAINS "sudo"
      OR payload.argv CONTAINS "disk"
      OR payload.argv CONTAINS "video"
      OR payload.argv CONTAINS "shadow"
      OR payload.argv CONTAINS "lxc"
      OR payload.argv CONTAINS "lxd"
    )
