# Title: Kernel Object File Creation

# Creation date: 2025/04/14

# MITRE ATT&CK Tactic: TA0003 - Persistence - https://attack.mitre.org/tactics/TA0003/

# MITRE ATT&CK Technique: T1547 - Boot or Logon Autostart Execution - https://attack.mitre.org/techniques/T1547/

# Check the whitelist, this rule is useless since we already chekcs for insmod/kmod, ecc??
- name: Kernel Object File Creation
  type: FileCreated
  category: persistence
  severity: low
  description: Detects the creation of Linux kernel object files (.ko), which are used to load modules into the kernel. 
    Adversaries may create or drop malicious kernel modules to execute code with kernel privileges, enabling stealthy persistence, rootkits, or bypassing security controls.
  condition: payload.filename ENDS_WITH ".ko"
    AND NOT (
      payload.filename STARTS_WITH "/tmp/mkinitramfs" OR
      payload.filename STARTS_WITH "/var/tmp/mkinitramfs_" OR
      header.image ENDS_WITH "/make" OR
      header.image ENDS_WITH "/dkms" OR
      header.image ENDS_WITH "cpio" OR
      header.image STARTS_WITH "/snap/"
    )
