# Title: Linux init (PID 1) Secret Dump via GDB

# Creation date: 2023/08/30

# MITRE ATT&CK Tactic: TA0006 - Credential Access - https://attack.mitre.org/tactics/TA0006/

# MITRE ATT&CK Technique: T1003 - OS Credential Dumping - https://attack.mitre.org/techniques/T1003/

- name: GDB process execution with specific arguments
  type: Exec
  category: credential_access
  severity: medium
  description: Detects the execution of the GDB utility with specific arguments. Attackers can exploit the GDB utility to 
    dump the memory of the init process (PID 1) to extract sensitive information, potentially enabling unauthorized access to internal 
    resources and remote control over compromised systems.
  condition: payload.filename ENDS_WITH "/gdb" 
    AND (payload.argv CONTAINS "--pid" 
    OR payload.argv CONTAINS "-p"
    OR payload.argv CONTAINS "attach") 
    AND payload.argv CONTAINS "1"


- name: strace execution with specific arguments
  type: Exec
  category: credential_access
  severity: medium
  description: Detects the execution of the ptrace syscall (called by strace) with specific arguments. Attackers can exploit ptrace to 
    dump the memory of the init process (PID 1) to extract sensitive information, potentially enabling unauthorized access to internal 
    resources and remote control over compromised systems.
  condition: payload.filename ENDS_WITH "strace"
    AND (payload.argv CONTAINS "--pid"
    OR payload.argv CONTAINS "-p")
    AND payload.argv CONTAINS "1"


- name: Suspicious commnand targeting /proc filesystem
  type: FileOpened
  category: credential_access
  severity: low
  description: Detects attempt to search process memory for credential patterns within the /proc filesystem.
    Adversaries may gather credentials from the proc filesystem or /proc. (Tools like LaZagne or MimiPenguin)
  condition: payload.filename STARTS_WITH "/proc" AND (payload.filename ENDS_WITH "/maps" OR payload.filename ENDS_WITH "/mem")
    AND payload.flags CONTAINS "O_RDONLY"